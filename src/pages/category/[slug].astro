---
import BaseLayout from '../../layouts/BaseLayout.astro';
import CategoryFilter from '../../components/CategoryFilter.astro';
import LanguageFilter from '../../components/LanguageFilter.astro';
import DateGroupedArticles from '../../components/DateGroupedArticles.astro';
import ViewToggle from '../../components/ViewToggle.astro';
import { CATEGORIES, type CategorySlug } from '../../types/article';
import type { Article } from '../../types/article';
import type { GetStaticPaths } from 'astro';

import articlesData from '../../data/articles.json';
const allArticles = articlesData as Article[];

export const getStaticPaths: GetStaticPaths = () => {
  return Object.keys(CATEGORIES).map((slug) => ({
    params: { slug },
  }));
};

const { slug } = Astro.params;
const categorySlug = slug as CategorySlug;
const categoryLabel = CATEGORIES[categorySlug];
const articles = allArticles.filter((a) => a.category === categorySlug);
---

<BaseLayout title={categoryLabel} description={`${categoryLabel}に関する最新ニュース`}>
  <div class="space-y-6">
    <div>
      <h1 class="text-2xl font-bold mb-4">{categoryLabel}</h1>
      <div class="space-y-3">
        <CategoryFilter current={categorySlug} />
        <LanguageFilter />
      </div>
    </div>

    <div class="flex items-center justify-between">
      <p class="text-sm text-gray-500" data-article-count>{articles.length}件の記事</p>
      <ViewToggle />
    </div>

    <DateGroupedArticles articles={articles} emptyMessage="このカテゴリの記事はまだありません。" />
  </div>
</BaseLayout>
